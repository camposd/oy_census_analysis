labs(fill = "Parental Status")
knitr::opts_chunk$set(echo = FALSE,
warning = F,
message = F,
fig.height = 4,
fig.width = 8)
source(
here::here(
'R',
'presentation_setup.R'
)
)
analysis_data <-
load_data$load_population_estimates()[['q2_household']]
# analysis_data <-
#   modify(.x = analysis_data,
#          .f = ~.x %>% mutate(oy_flag = figure_helpers$format_oy_variable(oy_flag)))
analysis_data <-
map(
.x = analysis_data,
.f = ~
.x %>%
modify_at(.x = .,
.at = 'oy_flag',
.f = figure_helpers$format_oy_variable) %>%
modify_at(.x = .,
.at = 'oy_hh_flag',
.f = figure_helpers$format_oy_hh_variable))
erase_y_axis =
theme(
axis.text.y = element_blank(),
axis.line.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()
)
erase_x_legend =
theme(
axis.title.x = element_blank()
)
# Settings for the lower error bar
# other option is percent_low
error_bar_low <-
rlang::sym('percent')
# color contrasts between Connected Youth and Opportunity Youth
# color_contrast <-
#   c(`Connected Youth` = "#800000", `Opportunity Youth` = '#D5802B')
color_contrast <-
c(`Connected Youth` = "#767676", `Opportunity Youth` = '#D5802B')
basic_plot <- function(data, fill_label = NULL){
fill_col = names(data)[2] %>% rlang::sym()
x_col =    names(data)[str_detect(names(data), "oy")] %>% rlang::sym()
data %>%
ggplot(aes(x = !!x_col, y = percent, fill = !!fill_col)) +
geom_col() +
geom_text(aes(label = if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = !!fill_col),
position = position_stack(vjust = .5)) +
theme_classic() +
scale_y_continuous(labels = scales::percent) +
# labs(y = "Percent",
#      caption = "Groups less than 5% suppressed for clarity"
#      ) +
erase_y_axis +
erase_x_legend +
theme(axis.text.x = element_text(face = 'bold'))
}
single_plot <- function(data, x_col){
x_col =    names(data)[str_detect(names(data), "oy")] %>% rlang::sym()
data %>%
ggplot(aes(x = !!x_col, y = percent)) +
geom_col() +
geom_errorbar(aes(ymax = percent_upp, ymin = percent_low),
width = .2) +
theme_classic() +
geom_text(aes(label = format(percent, digits = 3)),
position = position_stack(vjust = .5)) +
# labs( y = "Average Number of Children") +
erase_x_legend +
theme(axis.text.x = element_text(face = 'bold'))
}
analysis_data$hh_children %>%
basic_plot() +
labs(fill = "Parental Status")
analysis_data$hh_num_children %>%
single_plot() +
labs(
y = "Average number of children"
)
analysis_data$hh_average_income %>%
ggplot(aes(x = oy_hh_flag, y = percent)) +
geom_col() +
geom_errorbar(aes(ymax = percent_upp, ymin = percent),
width = .2) +
theme_classic() +
geom_text(aes(label = scales::dollar(percent, digits = 3)),
position = position_stack(vjust = .5)) +
labs( y = "Average Yearly Income") +
scale_y_continuous(labels = scales::dollar) +
erase_x_legend +
coord_flip()
analysis_data$income_bracket %>%
# filter(oy_flag != "Everyone Else") %>%
basic_plot() +
labs(fill = "Income Bracket")
analysis_data$hh_food_stamps %>%
basic_plot() +
labs(fill = "Food Stamp Recipient") +
scale_x_discrete(labels = function(x) str_wrap(x, 10))
analysis_data$hh_type %>%
basic_plot() +
labs(fill = "Type of Household")
analysis_data$workers_in_fam %>%
basic_plot() +
labs(fill = "Workers in Family")
analysis_data$hh_married %>%
basic_plot() +
labs(fill = "Marital Status")
analysis_data$hh_partnered %>%
basic_plot() +
labs("Partner Status")
analysis_data$hh_migration %>%
basic_plot() +
labs(fill = "Migration Status")
analysis_data$hh_transportation_mode %>%
mutate(JWTR_label = str_remove(JWTR_label, "\\(.*\\)")) %>%
basic_plot() +
labs(fill = "Mode of Transport")
analysis_data$commute_bracket %>%
basic_plot() +
labs(fill = "Commute Time")
rm(list = ls())
knitr::opts_chunk$set(echo = FALSE,
warning = F,
message = F,
fig.height = 4,
fig.width = 8)
source(
here::here(
'R',
'presentation_setup.R'
)
)
```{r load-data}
analysis_data <-
load_data$load_population_estimates()
names(analysis_data)
knitr::opts_chunk$set(echo = FALSE,
warning = F,
message = F,
fig.height = 4,
fig.width = 8)
source(
here::here(
'R',
'presentation_setup.R'
)
)
analysis_data <-
load_data$load_population_estimates()['q1_demographics']
analysis_data <-
imap(
.x = analysis_data,
.f = ~
if(.y %in% c("total_population_age_bracket",
'geo_puma_pop')){
.x
}else{
.x %>%
mutate(
oy_flag = figure_helpers$format_oy_variable(oy_flag)
) %>%
filter(oy_flag != "Everyone Else")
}
)
analysis_data$q1_demographics
analysis_data <-
load_data$load_population_estimates()[['q1_demographics']]
analysis_data <-
imap(
.x = analysis_data,
.f = ~
if(.y %in% c("total_population_age_bracket",
'geo_puma_pop')){
.x
}else{
.x %>%
mutate(
oy_flag = figure_helpers$format_oy_variable(oy_flag)
) %>%
filter(oy_flag != "Everyone Else")
}
)
analysis_data$q2_household <-
modify(.x = analysis_data$q2_household,
.f = ~.x %>% mutate(oy_flag = figure_helpers$format_oy_variable(oy_flag)))
erase_axis =
theme(
axis.text.y = element_blank(),
axis.line.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()
)
# Settings for the lower error bar
# other option is percent_low
error_bar_low <-
rlang::sym('percent')
# color contrasts between Connected Youth and Opportunity Youth
# color_contrast <-
#   c(`Connected Youth` = "#800000", `Opportunity Youth` = '#D5802B')
color_contrast <-
c(`Connected Youth` = "#767676", `Opportunity Youth` = '#D5802B')
age_population <- analysis_data$total_population_age_bracket %>% select(age_bracket, n) %>% spread(key = age_bracket, value = n) %>% unlist()
analysis_data$total_population_age_bracket %>%
ggplot(aes(x = age_bracket, y = percent)) +
geom_col(width = .85,
color = 'black',
fill = "#D5802B") +
geom_text(aes(label =
scales::percent(percent)),
vjust = -.25,
position = position_stack(vjust = .5)) +
geom_errorbar(
aes(ymin = !!error_bar_low,
ymax = percent_upp),
width = .1
) +
theme_classic() +
labs(x = "Age bracket of Chicago Population",
y = "Percent") +
scale_y_continuous(labels = scales::percent) +
erase_axis +
scale_x_discrete(labels = function(x) paste0(x,
figure_helpers$fig_help$newline,
figure_helpers$fig_help$N,
format(age_population, big.mark = ',')))
total_sample <-
analysis_data$total_oy_population %>%
select(oy_flag, n) %>%
arrange(oy_flag) %>%
pivot_wider(names_from = oy_flag, values_from = n) %>%
unlist()
analysis_data$total_oy_population %>%
# filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(width = .5,
fill = color_contrast,
color = 'black') +
geom_text(aes(label = scales::percent(percent, accuracy = .1)),
position = position_stack(.5))+
geom_errorbar(
mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1
) +
theme_classic() +
scale_x_discrete(labels = function(x) paste0(x,
figure_helpers$fig_help$newline,
figure_helpers$fig_help$N,
format(total_sample, big.mark = ',')))+
labs(
x = "",
y = 'Population Estimate',
caption =
str_wrap("*A subset of the population of 16-24 year olds is not captured as either Opportunity Youth or Connected Youth due to missing responses in the data. ",
width = 80)
) +
scale_y_continuous(labels = scales::percent) +
erase_axis
analysis_data$oy_race_alternate %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = race_alternate),
width = .5)+
geom_text(aes(label =
if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = race_alternate),
position = position_stack(vjust = .5)) +
theme_classic() +
labs(
y = figure_helpers$y_percent,
x = "",
fill = "Race or Ethnicity",
caption =
"* Percentages less than 5% suppressed for clarity"
) +
ggsci::scale_fill_uchicago() +
# scale_fill_brewer(palette = 7, direction = 1, type = 'seq') +
erase_axis
analysis_data$oy_race_alternate %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(aes(fill = race_alternate),
position = 'dodge',
color = 'black') +
geom_errorbar(
aes(ymin = !!error_bar_low,
ymax = percent_upp,
group = race_alternate),
width = .1,
position = position_dodge(width = .9, preserve = 'total')
)+
geom_text(aes(
label = if_else(percent >= .05,
scales::percent(percent, accuracy = .1),
""),
group = race_alternate),
position = position_dodge(width = .9),
vjust = 2,
size = 3.2
) +
labs(x = "",
y = figure_helpers$y_percent,
fill = "Race / Ethnicity",
caption = "* Percentages less than 5% suppressed for clarity"
) +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'right'
) +
scale_fill_discrete(labels = function(x) str_wrap(x, 15)) +
# scale_fill_brewer(palette = 7, direction = 1)
ggsci::scale_fill_uchicago()
# Male
analysis_data$oy_sex %>%
filter(SEX_label != "Female") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(width = .5,
# color = 'black',
aes(fill = oy_flag),
color = 'black'
) +
geom_errorbar( aes(ymax = percent_upp ,
ymin = !!error_bar_low),
width = .1) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = SEX_label),
position = position_stack(vjust = .5),
vjust = -.25
) +
labs(x = "Percentage of individuals between 16-24 who identify as male",
y = figure_helpers$y_percent,
fill = "Sex / Gender") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis  +
scale_fill_manual(values = c(color_contrast)) +
guides(fill = FALSE)
analysis_data$oy_disability %>%
filter(DIS_label == "With a disability") %>%
ggplot(aes(x = oy_flag,y = percent)) +
geom_col(aes(fill = oy_flag),
width = .5,
color = 'black') +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = DIS_label),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1) +
labs(x =  "Percentage of individuals between 16-24 that report having a disability",
y = figure_helpers$y_percent,
color = "Disability Status") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_manual(values = color_contrast) +
guides(fill = FALSE)
analysis_data$oy_age_bracket %>%
filter(oy_flag != "Everyone Else",
age_bracket != "16-19") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(
# aes(fill = age_bracket),
fill = color_contrast,
color = 'black',
width = .5
) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = age_bracket),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(
mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1
) +
labs(x = "Percentage of individuals between 20-24",
y = figure_helpers$y_percent,
fill = "Age Bracket") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_brewer(palette = 7)
analysis_data$oy_race_gender_alternate %>%
# filter(SEX_label != "Female") %>%
ggplot(aes(x = race_alternate,
y = percent)) +
geom_col(aes(fill = SEX_label)) +
facet_wrap(~oy_flag) +
coord_flip() +
theme_classic() +
geom_text(aes(label = scales::percent(percent, accuracy = .1),
group = SEX_label),
size = 2,
position = position_stack(vjust= .5)) +
scale_y_continuous(labels = scales::percent) +
theme(
strip.background = element_blank(),
strip.text.x = element_text(face = 'bold'),
axis.line.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
) +
labs(
x = "Race",
y = "Percentage",
fill = "Sex"
) +
scale_x_discrete(labels = function(x) str_wrap(x, 20)) +
scale_fill_manual(values =
c(
"#fff7bc",
"#D5802B"
)) +
guides(
# fill = FALSE
)
analysis_data$oy_race_gender_alternate %>%
filter(SEX_label != "Female") %>%
ggplot(aes(x = race_alternate,
y = percent)) +
geom_col(aes(fill = SEX_label),
color = 'black') +
facet_wrap(~oy_flag) +
coord_flip() +
theme_classic() +
geom_text(aes(label = scales::percent(percent, accuracy = .1),
group = SEX_label),
size = 2,
position = position_stack(vjust= .5)) +
scale_y_continuous(labels = scales::percent) +
theme(
strip.background = element_blank(),
strip.text.x = element_text(face = 'bold'),
axis.line.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
) +
labs(
x = "Race",
y = "Percentage and Race of ",
fill = "Sex"
) +
scale_x_discrete(labels = function(x) str_wrap(x, 20)) +
scale_fill_manual(values =
c(
# "#fff7bc",
"#D5802B"
)) +
guides(
fill = FALSE
) +
geom_errorbar(aes(ymin = percent, ymax = percent_upp),
width = .3)
analysis_data$oy_race_gender_alternate %>%
filter(SEX_label != "Female") %>%
ggplot(aes(x = race_alternate,
y = percent)) +
geom_col(aes(fill = oy_flag),
position = 'dodge') +
scale_x_discrete(labels = function(x) str_wrap(x, 10))
analysis_data$geo_puma_pop %>%
ggplot() +
geom_sf(aes(fill = opp_youth)) +
geom_sf_text(label =
analysis_data$geo_puma_pop$opp_youth,
size = 1.8) +
theme_void() +
scale_fill_gradient(low = "#fff7bc",
high = "#D5802B",
na.value = "white") +
labs(fill =
"Opportunity Youth Population")
analysis_data %>% names()
analysis_data <-
load_data$load_population_estimates()
analysis_data %>% names()
analysis_data$q1_demo %>% names()
analysis_data$q1_demographics %>% names()
ls()
