width = .1
) +
labs(x = "Percentage of individuals within 20-24",
y = figure_helpers$y_percent,
fill = "Age Bracket") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_brewer(palette = 7)
analysis_data$oy_age_bracket %>%
filter(oy_flag != "Everyone Else",
age_bracket != "16-19") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(
# aes(fill = age_bracket),
fill = color_contrast,
color = 'black',
width = .5
) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = age_bracket),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(
mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1
) +
labs(x = "Percentage of individuals within 20-24",
y = figure_helpers$y_percent,
fill = "Age Bracket") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_brewer(palette = 7)
analysis_data$oy_age_bracket %>%
filter(oy_flag != "Everyone Else",
age_bracket != "16-19") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(
# aes(fill = age_bracket),
fill = color_contrast,
color = 'black',
width = .5
) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = age_bracket),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(
mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1
) +
labs(x = "Percentage of individuals within 20-24",
y = figure_helpers$y_percent,
fill = "Age Bracket") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_brewer(palette = 7)
analysis_data$oy_age_bracket %>%
filter(oy_flag != "Everyone Else",
age_bracket != "16-19") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(
# aes(fill = age_bracket),
fill = color_contrast,
color = 'black',
width = .5
) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = age_bracket),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(
mapping = aes(ymin = percent_low, ymax = percent_upp),
width = .1
) +
labs(x = "Percentage of individuals within 20-24",
y = figure_helpers$y_percent,
fill = "Age Bracket") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_brewer(palette = 7)
pums_variables %>% names()
ls()
rm(list = ls())
tidycensus::pums_variables %>% head()
knitr::opts_chunk$set(echo = FALSE,
warning = F,
message = F,
fig.height = 4,
fig.width = 8)
source(
here::here(
'R',
'presentation_setup.R'
)
)
analysis_data <-
load_data$load_population_estimates()
analysis_data <-
imap(
.x = analysis_data,
.f = ~
if(.y == "total_population_age_bracket"){
.x
}else{
.x %>%
mutate(
oy_flag = figure_helpers$format_oy_variable(oy_flag)
) %>%
filter(oy_flag != "Everyone Else")
}
)
erase_axis =
theme(
axis.text.y = element_blank(),
axis.line.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()
)
# Settings for the lower error bar
# other option is percent_low
error_bar_low <-
rlang::sym('percent')
# color contrasts between Connected Youth and Opportunity Youth
color_contrast <-
c(`Connected Youth` = "#fec44f", `Opportunity Youth` = '#D5802B')
age_population <- analysis_data$total_population_age_bracket %>% select(age_bracket, n) %>% spread(key = age_bracket, value = n) %>% unlist()
analysis_data$total_population_age_bracket %>%
ggplot(aes(x = age_bracket, y = percent)) +
geom_col(width = .85,
color = 'black',
fill = "#D5802B") +
geom_text(aes(label =
scales::percent(percent)),
vjust = -.25,
position = position_stack(vjust = .5)) +
geom_errorbar(
aes(ymin = !!error_bar_low,
ymax = percent_upp),
width = .1
) +
theme_classic() +
labs(x = "Age bracket of Chicago Population",
y = "Percent") +
scale_y_continuous(labels = scales::percent) +
erase_axis +
scale_x_discrete(labels = function(x) paste0(x,
figure_helpers$fig_help$newline,
figure_helpers$fig_help$N,
format(age_population, big.mark = ',')))
total_sample <-
analysis_data$total_oy_population %>%
select(oy_flag, n) %>%
arrange(oy_flag) %>%
pivot_wider(names_from = oy_flag, values_from = n) %>%
unlist()
analysis_data$total_oy_population %>%
# filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(width = .5,
fill = color_contrast,
color = 'black') +
geom_text(aes(label = scales::percent(percent, accuracy = .1)),
position = position_stack(.5))+
geom_errorbar(
mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1
) +
theme_classic() +
scale_x_discrete(labels = function(x) paste0(x,
figure_helpers$fig_help$newline,
figure_helpers$fig_help$N,
format(total_sample, big.mark = ',')))+
labs(
x = "",
y = 'Population Estimate',
caption =
str_wrap("*A subset of the population of 16-24 year olds is not captured as either Opportunity Youth or Connected Youth due to missing responses in the data. ",
width = 80)
) +
scale_y_continuous(labels = scales::percent) +
erase_axis
analysis_data$oy_race_alternate %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = race_alternate),
width = .5)+
geom_text(aes(label =
if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = race_alternate),
position = position_stack(vjust = .5)) +
theme_classic() +
labs(
y = figure_helpers$y_percent,
x = "",
fill = "Race or Ethnicity",
caption =
"* Percentages less than 5% suppressed for clarity"
) +
scale_fill_brewer(palette = 7, direction = -1, type = 'seq') +
erase_axis
analysis_data$oy_race_alternate %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(aes(fill = race_alternate),
position = 'dodge',
color = 'black') +
geom_errorbar(
aes(ymin = !!error_bar_low,
ymax = percent_upp,
group = race_alternate),
width = .1,
position = position_dodge(width = .9, preserve = 'total')
)+
geom_text(aes(
label = if_else(percent >= .05,
scales::percent(percent, accuracy = .1),
""),
group = race_alternate),
position = position_dodge(width = .9),
vjust = 2,
size = 3.2
) +
labs(x = "",
y = figure_helpers$y_percent,
fill = "Race / Ethnicity",
caption = "* Percentages less than 5% suppressed for clarity"
) +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'right'
) +
scale_fill_discrete(labels = function(x) str_wrap(x, 15)) +
scale_fill_brewer(palette = 7, direction = 1)
# Male
analysis_data$oy_sex %>%
filter(SEX_label != "Female") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(width = .5,
# color = 'black',
aes(fill = oy_flag),
color = 'black'
) +
geom_errorbar( aes(ymax = percent_upp ,
ymin = !!error_bar_low),
width = .1) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = SEX_label),
position = position_stack(vjust = .5),
vjust = -.25
) +
labs(x = "Percentage of individuals between 16-24 who identify as male",
y = figure_helpers$y_percent,
fill = "Sex / Gender") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis  +
scale_fill_manual(values = c(color_contrast)) +
guides(fill = FALSE)
analysis_data$oy_disability %>%
filter(DIS_label == "With a disability") %>%
ggplot(aes(x = oy_flag,y = percent)) +
geom_col(aes(fill = oy_flag),
width = .5,
color = 'black') +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = DIS_label),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1) +
labs(x =  "Percentage of individuals 16-24 that report having a disability",
y = figure_helpers$y_percent,
color = "Disability Status") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_manual(values = color_contrast) +
guides(fill = FALSE)
analysis_data$oy_age_bracket %>%
filter(oy_flag != "Everyone Else",
age_bracket != "16-19") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(
# aes(fill = age_bracket),
fill = color_contrast,
color = 'black',
width = .5
) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = age_bracket),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(
mapping = aes(ymin = percent_low, ymax = percent_upp),
width = .1
) +
labs(x = "Percentage of individuals within 20-24",
y = figure_helpers$y_percent,
fill = "Age Bracket") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_brewer(palette = 7)
ls()
analysis_data$oy_age_bracket %>%
filter(oy_flag != "Everyone Else",
age_bracket != "16-19") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(
# aes(fill = age_bracket),
fill = color_contrast,
color = 'black',
width = .5
) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = age_bracket),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(
mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1
) +
labs(x = "Percentage of individuals within 20-24",
y = figure_helpers$y_percent,
fill = "Age Bracket") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_brewer(palette = 7)
analysis_data$oy_age_bracket %>%
filter(oy_flag != "Everyone Else",
age_bracket != "16-19") %>%
ggplot(aes(x = oy_flag,
y = percent)) +
geom_col(
# aes(fill = age_bracket),
fill = color_contrast,
color = 'black',
width = .5
) +
geom_text(
aes(
label = scales::percent(percent, accuracy = .1),
group = age_bracket),
position = position_stack(vjust = .5),
vjust = -.25
) +
geom_errorbar(
mapping = aes(ymin = !!error_bar_low, ymax = percent_upp),
width = .1
) +
labs(x = "Percentage of individuals within 20-24",
y = figure_helpers$y_percent,
fill = "Age Bracket") +
scale_y_continuous(labels = scales::percent) +
theme_classic() +
theme(
legend.position = 'bottom'
) +
erase_axis +
scale_fill_brewer(palette = 7)
ls()
library(tidycensus)
pums_variables %>%
filter(str_detect(var_code, 'children'))
pums_variables %>%
filter(str_detect(var_label, 'children'))
pums_variables %>%
filter(str_detect(var_label, 'children')) %>% View()
pums_variables %>%
filter(str_detect(var_label, 'child'))
pums_variables %>%
filter(str_detect(var_label, 'child')) %>%
View()
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'child')) %>%
View()
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'child')) %>% distinct(var_label) %>% View()
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'homeless')) %>% distinct(var_label)
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'mar')) %>% distinct(var_label)
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'marriage')) %>% distinct(var_label)
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'mar')) %>% distinct(var_label)
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'spouse')) %>% distinct(var_label)
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'spouse')) %>% distinct(var_code, var_label)
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'income')) %>% distinct(var_code, var_label)
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'income')) %>% distinct(var_code, var_label) %>% View('income')
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'parent')) %>% distinct(var_code, var_label) %>% View('parent')
pums_variables %>%
filter(year == 2018, str_detect(var_label, 'family')) %>% distinct(var_code, var_label) %>% View('family')
pums_df <-
load_data$load_clean_pums()
here::here()
analysis_data$oy_race_alternate %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = race_alternate),
width = .5)+
geom_text(aes(label =
if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = race_alternate),
position = position_stack(vjust = .5)) +
theme_classic() +
labs(
y = figure_helpers$y_percent,
x = "",
fill = "Race or Ethnicity",
caption =
"* Percentages less than 5% suppressed for clarity"
) +
scale_fill_brewer(palette = 7, direction = 1, type = 'seq') +
erase_axis
install.packages('ggsci')
analysis_data$oy_race_alternate %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = race_alternate),
width = .5)+
geom_text(aes(label =
if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = race_alternate),
position = position_stack(vjust = .5)) +
theme_classic() +
labs(
y = figure_helpers$y_percent,
x = "",
fill = "Race or Ethnicity",
caption =
"* Percentages less than 5% suppressed for clarity"
) +
ggsci::scale_fill_uchicago() +
# scale_fill_brewer(palette = 7, direction = 1, type = 'seq') +
erase_axis
knitr::opts_chunk$set(echo = FALSE,
warning = F,
message = F,
fig.height = 4,
fig.width = 8)
source(
here::here(
'R',
'presentation_setup.R'
)
)
