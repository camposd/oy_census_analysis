position = position_stack(vjust= .5)) +
scale_y_continuous(labels = scales::percent) +
theme(
strip.background = element_blank(),
strip.text.x = element_text(face = 'bold'),
axis.line.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
) +
labs(
x = "Race",
y = "Percentage",
fill = "Sex"
) +
scale_x_discrete(labels = function(x) str_wrap(x, 20)) +
scale_fill_manual(values =
c(
"#fff7bc",
"#D5802B"
)) +
guides(
# fill = FALSE
)
analysis_data$oy_race_gender_alternate %>%
filter(SEX_label != "Female") %>%
ggplot(aes(x = race_alternate,
y = percent)) +
geom_col(aes(fill = SEX_label),
color = 'black') +
facet_wrap(~oy_flag) +
coord_flip() +
theme_classic() +
geom_text(aes(label = scales::percent(percent, accuracy = .1),
group = SEX_label),
size = 2,
position = position_stack(vjust= .5)) +
scale_y_continuous(labels = scales::percent) +
theme(
strip.background = element_blank(),
strip.text.x = element_text(face = 'bold'),
axis.line.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
) +
labs(
x = "Race",
y = "Percentage and Race of ",
fill = "Sex"
) +
scale_x_discrete(labels = function(x) str_wrap(x, 20)) +
scale_fill_manual(values =
c(
# "#fff7bc",
"#D5802B"
)) +
guides(
fill = FALSE
) +
geom_errorbar(aes(ymin = percent, ymax = percent_upp),
width = .3)
analysis_data$oy_race_gender_alternate %>%
filter(SEX_label != "Female") %>%
ggplot(aes(x = race_alternate,
y = percent)) +
geom_col(aes(fill = oy_flag),
position = 'dodge') +
scale_x_discrete(labels = function(x) str_wrap(x, 10))
analysis_data$geo_puma_pop %>%
ggplot() +
geom_sf(aes(fill = opp_youth)) +
geom_sf_text(label =
analysis_data$geo_puma_pop$opp_youth,
size = 1.8) +
theme_void() +
scale_fill_gradient(low = "#fff7bc",
high = "#D5802B",
na.value = "white") +
labs(fill =
"Opportunity Youth Population")
analysis_data$oy_edu_attainment
analysis_data$oy_edu_attainment
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else")
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = n)) +
geom_col(aes(fill = SCHL_label))
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = n)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic()
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic()
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
labs(
fill = "Educational Attainment",
y = "Percent"
) +
erase_axis
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = fct_reorder(oy_flag, n), y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
labs(
fill = "Educational Attainment",
y = "Percent"
) +
erase_axis
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
labs(
fill = "Educational Attainment",
y = "Percent"
) +
erase_axis
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
labs(
fill = "Educational Attainment",
y = "Percent"
) +
erase_axis +
theme(axis.title.x = element_blank())
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
labs(
fill = "Educational Attainment",
y = "Percent"
) +
erase_axis +
theme(axis.title.x = element_blank()) +
geom_text(aes(label = if_else(percent > .05,
scale::percent(percent, accuracy = .1),
""),
group = SCHL_label),
position = position_dodge(vjust = .5))
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
labs(
fill = "Educational Attainment",
y = "Percent"
) +
erase_axis +
theme(axis.title.x = element_blank()) +
geom_text(aes(label = if_else(percent > .05,
scale::percent(percent, accuracy = .1),
""),
group = SCHL_label),
position = position_stack(vjust = .5))
analysis_data$oy_edu_attainment %>%
filter(oy_flag != "Everyone Else") %>%
ggplot(aes(x = oy_flag, y = percent)) +
geom_col(aes(fill = SCHL_label)) +
theme_classic() +
labs(
fill = "Educational Attainment",
y = "Percent"
) +
erase_axis +
theme(axis.title.x = element_blank()) +
geom_text(aes(label = if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = SCHL_label),
position = position_stack(vjust = .5))
ls()
ls()
knitr::opts_chunk$set(echo = FALSE,
warning = F,
message = F,
fig.height = 4,
fig.width = 8)
source(
here::here(
'R',
'presentation_setup.R'
)
)
analysis_data <-
load_data$load_population_estimates()[['q2_household']]
# analysis_data <-
#   modify(.x = analysis_data,
#          .f = ~.x %>% mutate(oy_flag = figure_helpers$format_oy_variable(oy_flag)))
analysis_data <-
map(
.x = analysis_data,
.f = ~
.x %>%
modify_at(.x = .,
.at = 'oy_flag',
.f = figure_helpers$format_oy_variable) %>%
modify_at(.x = .,
.at = 'oy_hh_flag',
.f = figure_helpers$format_oy_hh_variable))
erase_y_axis =
theme(
axis.text.y = element_blank(),
axis.line.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()
)
erase_x_legend =
theme(
axis.title.x = element_blank()
)
# Settings for the lower error bar
# other option is percent_low
error_bar_setting <-
rlang::sym('percent')
# color contrasts between Connected Youth and Opportunity Youth
# color_contrast <-
#   c(`Connected Youth` = "#800000", `Opportunity Youth` = '#D5802B')
color_contrast <-
c(`Connected Youth` = "#767676", `Opportunity Youth` = '#D5802B')
color_contrast_alt <- color_contrast
names(color_contrast_alt) <- NULL
color_palette <-
ggsci::pal_uchicago(palette = 'default')
color_palette_light <-
ggsci::pal_uchicago(palette = 'light')
basic_plot <- function(data, fill_label = NULL){
fill_col = names(data)[2] %>% rlang::sym()
x_col =    names(data)[str_detect(names(data), "oy")] %>% rlang::sym()
data %>%
filter(!str_detect(!!x_col, 'Everyone')) %>%
ggplot(aes(x = !!x_col, y = percent, fill = !!fill_col)) +
geom_col(color = 'black') +
geom_text(aes(label = if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = !!fill_col),
position = position_stack(vjust = .5)) +
theme_classic() +
scale_y_continuous(labels = scales::percent) +
erase_y_axis +
erase_x_legend +
theme(axis.text.x = element_text(face = 'bold')) +
labs(
caption = "Cells representing less than 5% suppressed for clarity") +
ggsci::scale_fill_uchicago()
}
single_plot <- function(data, x_col){
x_col =    names(data)[str_detect(names(data), "oy")] %>% rlang::sym()
data %>%
ggplot(aes(x = !!x_col, y = percent)) +
geom_col(color = 'black',
fill = color_contrast[2]) +
geom_errorbar(aes(ymax = percent_upp, ymin = !!error_bar_setting),
width = .2) +
theme_classic() +
geom_text(aes(label = format(percent, digits = 3)),
position = position_stack(vjust = .5)) +
# labs( y = "Average Number of Children") +
erase_x_legend +
theme(axis.text.x = element_text(face = 'bold')) +
labs(
caption = "Cells representing less than 5% suppressed for clarity"
)
}
wrap_x_labels =
scale_x_discrete(labels = function(x) str_wrap(x,10))
analysis_data$hh_children %>%
basic_plot() +
labs(fill = "Parental Status") +
wrap_x_labels +
scale_fill_manual(values = color_contrast_alt)
analysis_data$hh_num_children %>%
single_plot() +
labs(
y = "Average number of children"
) +
wrap_x_labels
analysis_data$hh_average_income %>%
ggplot(aes(x = oy_hh_flag, y = percent)) +
geom_col(color = 'black',
fill = color_contrast[2]) +
geom_errorbar(aes(ymax = percent_upp, ymin = !!error_bar_setting),
width = .2) +
theme_classic() +
geom_text(aes(label = scales::dollar(percent)),
position = position_stack(vjust = .5)) +
# labs( y = "Average Number of Children") +
erase_x_legend +
theme(axis.text.x = element_text(face = 'bold')) +
labs(
y = "Average Total Income",
caption = "Cells representing less than 5% suppressed for clarity"
) +
wrap_x_labels +
scale_y_continuous(labels = scales::dollar)
analysis_data$hh_income_bracket %>%
# filter(oy_flag != "Everyone Else") %>%
basic_plot() +
labs(fill = "Income Bracket") +
wrap_x_labels +
scale_fill_manual(values = c(color_contrast_alt[2],color_palette(9), color_palette_light(9)))
analysis_data$hh_food_stamps %>%
basic_plot() +
labs(fill = "Food Stamp Recipient") +
wrap_x_labels +
scale_fill_manual(values = color_contrast_alt)
analysis_data$hh_type %>%
basic_plot() +
labs(fill = "Type of Household") +
scale_fill_manual(values = c(color_contrast[2], color_palette_light(8)))
analysis_data$hh_workers_in_fam %>%
basic_plot() +
labs(fill = "Workers in Family") +
wrap_x_labels +
scale_fill_manual(values = c(color_contrast_alt[2], color_palette_light(4)))
analysis_data$hh_married %>%
basic_plot() +
labs(fill = "Marital Status") +
wrap_x_labels  +
scale_fill_manual(values = c(color_contrast_alt[2], rev(color_palette(5))))
analysis_data$hh_partnered %>%
basic_plot() +
labs("Partner Status") +
wrap_x_labels
analysis_data$hh_migration %>%
basic_plot() +
labs(fill = "Migration Status") +
wrap_x_labels +
scale_fill_manual(values = c(color_palette(3), color_contrast_alt[2]))
analysis_data$hh_transportation_mode %>%
mutate(JWTR_label = str_remove(JWTR_label, "\\(.*\\)")) %>%
basic_plot() +
labs(fill = "Mode of Transport") +
wrap_x_labels +
scale_fill_manual(values = c(color_palette(9), color_palette_light(9)))
analysis_data$hh_commute_bracket %>%
basic_plot() +
labs(fill = "Commute Time (minutes)") +
wrap_x_labels +
scale_fill_manual(values = c(color_contrast_alt[2], color_palette(9), color_palette_light(1)))
knitr::opts_chunk$set(echo = FALSE,
warning = F,
message = F,
fig.height = 4,
fig.width = 8)
source(
here::here(
'R',
'presentation_setup.R'
)
)
analysis_data <-
load_data$load_population_estimates()[['q2_household']]
# analysis_data <-
#   modify(.x = analysis_data,
#          .f = ~.x %>% mutate(oy_flag = figure_helpers$format_oy_variable(oy_flag)))
analysis_data <-
map(
.x = analysis_data,
.f = ~
.x %>%
modify_at(.x = .,
.at = 'oy_flag',
.f = figure_helpers$format_oy_variable) %>%
modify_at(.x = .,
.at = 'oy_hh_flag',
.f = figure_helpers$format_oy_hh_variable))
erase_y_axis =
theme(
axis.text.y = element_blank(),
axis.line.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()
)
erase_x_legend =
theme(
axis.title.x = element_blank()
)
# Settings for the lower error bar
# other option is percent_low
error_bar_setting <-
rlang::sym('percent')
# color contrasts between Connected Youth and Opportunity Youth
# color_contrast <-
#   c(`Connected Youth` = "#800000", `Opportunity Youth` = '#D5802B')
color_contrast <-
c(`Connected Youth` = "#767676", `Opportunity Youth` = '#D5802B')
color_contrast_alt <- color_contrast
names(color_contrast_alt) <- NULL
color_palette <-
ggsci::pal_uchicago(palette = 'default')
color_palette_light <-
ggsci::pal_uchicago(palette = 'light')
basic_plot <- function(data, fill_label = NULL){
fill_col = names(data)[2] %>% rlang::sym()
x_col =    names(data)[str_detect(names(data), "oy")] %>% rlang::sym()
data %>%
filter(!str_detect(!!x_col, '(Everyone)|(Eveyrone')) %>%
ggplot(aes(x = !!x_col, y = percent, fill = !!fill_col)) +
geom_col(color = 'black') +
geom_text(aes(label = if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = !!fill_col),
position = position_stack(vjust = .5)) +
theme_classic() +
scale_y_continuous(labels = scales::percent) +
erase_y_axis +
erase_x_legend +
theme(axis.text.x = element_text(face = 'bold')) +
labs(
caption = "Cells representing less than 5% suppressed for clarity") +
ggsci::scale_fill_uchicago()
}
single_plot <- function(data, x_col){
x_col =    names(data)[str_detect(names(data), "oy")] %>% rlang::sym()
data %>%
ggplot(aes(x = !!x_col, y = percent)) +
geom_col(color = 'black',
fill = color_contrast[2]) +
geom_errorbar(aes(ymax = percent_upp, ymin = !!error_bar_setting),
width = .2) +
theme_classic() +
geom_text(aes(label = format(percent, digits = 3)),
position = position_stack(vjust = .5)) +
# labs( y = "Average Number of Children") +
erase_x_legend +
theme(axis.text.x = element_text(face = 'bold')) +
labs(
caption = "Cells representing less than 5% suppressed for clarity"
)
}
wrap_x_labels =
scale_x_discrete(labels = function(x) str_wrap(x,10))
analysis_data$hh_children %>%
basic_plot() +
labs(fill = "Parental Status") +
wrap_x_labels +
scale_fill_manual(values = color_contrast_alt)
basic_plot <- function(data, fill_label = NULL){
fill_col = names(data)[2] %>% rlang::sym()
x_col =    names(data)[str_detect(names(data), "oy")] %>% rlang::sym()
data %>%
filter(!str_detect(!!x_col, '(Everyone)|(Eveyrone)')) %>%
ggplot(aes(x = !!x_col, y = percent, fill = !!fill_col)) +
geom_col(color = 'black') +
geom_text(aes(label = if_else(percent > .05,
scales::percent(percent, accuracy = .1),
""),
group = !!fill_col),
position = position_stack(vjust = .5)) +
theme_classic() +
scale_y_continuous(labels = scales::percent) +
erase_y_axis +
erase_x_legend +
theme(axis.text.x = element_text(face = 'bold')) +
labs(
caption = "Cells representing less than 5% suppressed for clarity") +
ggsci::scale_fill_uchicago()
}
analysis_data$hh_income_bracket %>%
# filter(oy_flag != "Everyone Else") %>%
basic_plot() +
labs(fill = "Income Bracket") +
wrap_x_labels +
scale_fill_manual(values = c(color_contrast_alt[2],color_palette(9), color_palette_light(9)))
ls()
knitr::opts_chunk$set(echo = FALSE,
warning = F,
message = F,
fig.height = 4,
fig.width = 8)
source(
here::here(
'R',
'presentation_setup.R'
)
)
ls()
source(
here::here(
'R',
'presentation_setup.R'
)
)
here::here()
